- name: Git checkout libphutil
  git:
    repo: https://github.com/phacility/libphutil.git
    dest: /home/dkl/.mozbuild/libphutil

- name: Git checkout arcanist
  git:
    repo: https://github.com/phacility/arcanist.git
    dest: /home/dkl/.mozbuild/arcanist

- name: Git checkout cinnabarc
  git:
    repo: https://github.com/mozilla-conduit/arcanist.git
    dest: /home/dkl/.mozbuild/cinnabarc

- name: Git checkout and install git-cinnabar
  shell: |
    git clone https://github.com/glandium/git-cinnabar.git --branch master --single-branch /home/dkl/.mozbuild/git-cinnabar
    export PATH=/home/dkl/.mozbuild/git-cinnabar:$PATH
    cd /home/dkl/.mozbuild/git-cinnabar && git cinnabar download

- name: Create /home/dkl/.mozbuild/moz-phab
  file:
    dest: /home/dkl/.mozbuild/moz-phab
    mode: 0755
    owner: dkl
    group: dkl
    state: directory

- name: Checkout moz-phab code review wrapper
  get_url:
    url: https://raw.githubusercontent.com/mozilla-conduit/review/a35696157c060cbc7a5a600f4d033f07b6c18da9/moz-phab
    dest: /home/dkl/.mozbuild/moz-phab/moz-phab
    mode: 0755

- name: Git checkout dotvim repo
  git:
    repo: https://github.com/dklawren/dotvim.git
    dest: /home/dkl/.vim

- name: Git checkout tmux plugin support
  git:
    repo: https://github.com/tmux-plugins/tpm
    dest: /home/dkl/.tmux/plugins/tpm

- name: Copy dotfiles
  copy:
    src: dotfiles/{{ item }}
    dest: /home/dkl
    owner: dkl
    group: dkl
    mode: 0644
  with_items:
    - .aliases
    - .bash_profile
    - .bashrc
    - .config
    - .exports
    - .functions
    - .gitconfig
    - .gitignore
    - .helpers
    - .hgrc
    - .inputrc
    - .NERDTreeBookmarks
    - .path
    - .tmux.conf

- name: Link vimrc
  file:
    src: /home/dkl/.vim/rc/vimrc
    dest: /home/dkl/.vimrc
    state: link

- name: Install Vundle plugins
  shell: cd /home/dkl/.vim && git submodule update --init --recursive && vim +PluginInstall +qall

- name: Download CircleCI CLI
  get_url:
    url: https://circle.ci/cli
    dest: /tmp/circle-ci-cli

- name: Install CircleCI CLI
  shell: bash /tmp/circle-ci-cli

- name: Remove the CircleCI CLI installer
  file:
    path: /tmp/circle-ci-cli
    state: absent

- name: Chown all home dir files to dkl.dkl
  file:
    dest: /home/dkl
    owner: dkl
    group: dkl
    recurse: yes
